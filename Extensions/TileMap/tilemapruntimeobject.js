var gdjs;(function(t){class l extends t.RuntimeObject{constructor(e,i){super(e,i);this._frameElapsedTime=0;this._opacity=i.content.opacity,this._tilemapJsonFile=i.content.tilemapJsonFile,this._tilesetJsonFile=i.content.tilesetJsonFile,this._tilemapAtlasImage=i.content.tilemapAtlasImage,this._displayMode=i.content.displayMode,this._layerIndex=i.content.layerIndex,this._levelIndex=i.content.levelIndex,this._animationSpeedScale=i.content.animationSpeedScale,this._animationFps=i.content.animationFps,this._tileMapManager=t.TileMap.TileMapRuntimeManager.getManager(e),this._renderer=new t.TileMapRuntimeObjectRenderer(this,e),this._updateTileMap(),this.onCreated()}getRendererObject(){return this._renderer.getRendererObject()}update(e){if(this._animationSpeedScale<=0||this._animationFps===0)return;const i=this.getElapsedTime()/1e3;for(this._frameElapsedTime+=i*this._animationSpeedScale;this._frameElapsedTime>1/this._animationFps;)this._renderer.incrementAnimationFrameX(e),this._frameElapsedTime-=1/this._animationFps}updateFromObjectData(e,i){return e.content.opacity!==i.content.opacity&&this.setOpacity(i.content.opacity),e.content.tilemapJsonFile!==i.content.tilemapJsonFile&&this.setTilemapJsonFile(i.content.tilemapJsonFile),e.content.tilesetJsonFile!==i.content.tilesetJsonFile&&this.setTilesetJsonFile(i.content.tilesetJsonFile),e.content.displayMode!==i.content.displayMode&&this.setDisplayMode(i.content.displayMode),e.content.layerIndex!==i.content.layerIndex&&this.setLayerIndex(i.content.layerIndex),e.content.levelIndex!==i.content.levelIndex&&this.setLevelIndex(i.content.levelIndex),e.content.animationSpeedScale!==i.content.animationSpeedScale&&this.setAnimationSpeedScale(i.content.animationSpeedScale),e.content.animationFps!==i.content.animationFps&&this.setAnimationFps(i.content.animationFps),e.content.tilemapAtlasImage===i.content.tilemapAtlasImage}getNetworkSyncData(){return{...super.getNetworkSyncData(),op:this._opacity,tmjf:this._tilemapJsonFile,tsjf:this._tilesetJsonFile,tmai:this._tilemapAtlasImage,dm:this._displayMode,lai:this._layerIndex,lei:this._levelIndex,asps:this._animationSpeedScale,wid:this.getWidth(),hei:this.getHeight()}}updateFromNetworkSyncData(e){super.updateFromNetworkSyncData(e),e.op!==void 0&&this.setOpacity(e.op),e.tmjf!==void 0&&this.setTilemapJsonFile(e.tmjf),e.tsjf!==void 0&&this.setTilesetJsonFile(e.tsjf),e.tmai!==void 0&&(this._tilemapAtlasImage=e.tmai),e.dm!==void 0&&this.setDisplayMode(e.dm),e.lai!==void 0&&this.setLayerIndex(e.lai),e.lei!==void 0&&this.setLevelIndex(e.lei),e.asps!==void 0&&this.setAnimationSpeedScale(e.asps),e.wid!==void 0&&this.setWidth(e.wid),e.hei!==void 0&&this.setHeight(e.hei)}extraInitializationFromInitialInstance(e){e.customSize&&(this.setWidth(e.width),this.setHeight(e.height))}_updateTileMap(){this._tileMapManager.getOrLoadTileMap(this._tilemapJsonFile,this._tilesetJsonFile,this._levelIndex,e=>{!e||this._tileMapManager.getOrLoadTextureCache(i=>{const s=this.getInstanceContainer().getGame(),n=s.resolveEmbeddedResource(this._tilemapJsonFile,i);return s.getImageManager().getPIXITexture(n)},this._tilemapAtlasImage,this._tilemapJsonFile,this._tilesetJsonFile,this._levelIndex,i=>{!i||this._renderer.updatePixiTileMap(e,i)})})}onDestroyed(){super.onDestroyed(),this._renderer.destroy()}setTilemapJsonFile(e){this._tilemapJsonFile=e,this._updateTileMap()}getTilemapJsonFile(){return this._tilemapJsonFile}isTilemapJsonFile(e){return this._tilemapJsonFile===e}setTilesetJsonFile(e){this._tilesetJsonFile=e,this._updateTileMap()}getTilesetJsonFile(){return this._tilesetJsonFile}setAnimationFps(e){this._animationFps=e}getAnimationFps(){return this._animationFps}isTilesetJsonFile(e){return this._tilesetJsonFile===e}isDisplayMode(e){return this._displayMode===e}setDisplayMode(e){this._displayMode=e,this._updateTileMap()}getDisplayMode(){return this._displayMode}setLayerIndex(e){this._layerIndex=e,this._updateTileMap()}getLayerIndex(){return this._layerIndex}setLevelIndex(e){this._levelIndex=e,this._updateTileMap()}getLevelIndex(){return this._levelIndex}setAnimationSpeedScale(e){this._animationSpeedScale=e}getAnimationSpeedScale(){return this._animationSpeedScale}setWidth(e){this.getWidth()!==e&&(this._renderer.setWidth(e),this.invalidateHitboxes())}setHeight(e){this.getHeight()!==e&&(this._renderer.setHeight(e),this.invalidateHitboxes())}setSize(e,i){this.setWidth(e),this.setHeight(i)}getScale(){const e=this.getScaleX(),i=this.getScaleY();return e===i?e:Math.sqrt(e*i)}setScale(e){this.setScaleX(e),this.setScaleY(e)}setScaleX(e){e<0&&(e=0),this.getScaleX()!==e&&(this._renderer.setScaleX(e),this.invalidateHitboxes())}setScaleY(e){e<0&&(e=0),this.getScaleY()!==e&&(this._renderer.setScaleY(e),this.invalidateHitboxes())}setX(e){super.setX(e),this._renderer.updatePosition()}setY(e){super.setY(e),this._renderer.updatePosition()}setAngle(e){super.setAngle(e),this._renderer.updateAngle()}setOpacity(e){this._opacity=e,this._renderer.updateOpacity()}getOpacity(){return this._opacity}getWidth(){return this._renderer.getWidth()}getHeight(){return this._renderer.getHeight()}getScaleX(){return this._renderer.getScaleX()}getScaleY(){return this._renderer.getScaleY()}}t.TileMapRuntimeObject=l,t.registerObject("TileMap::TileMap",t.TileMapRuntimeObject)})(gdjs||(gdjs={}));
//# sourceMappingURL=tilemapruntimeobject.js.map
