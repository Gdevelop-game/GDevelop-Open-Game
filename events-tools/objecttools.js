var gdjs;(function(i){let y;(function(O){let w;(function(g){g.pickOnly=function(s,t){for(const e in s.items)if(s.items.hasOwnProperty(e)){const n=s.items[e];n.indexOf(t)===-1?n.length=0:(n.length=0,n.push(t))}},g.twoListsTest=function(s,t,e,n,o){let f=!1;const l=i.staticArray(i.evtTools.object.twoListsTest);t.values(l);const u=i.staticArray2(i.evtTools.object.twoListsTest);e.values(u);for(let c=0,p=l.length;c<p;++c){let a=l[c];for(let r=0,b=a.length;r<b;++r)a[r].pick=!1}for(let c=0,p=u.length;c<p;++c){let a=u[c];for(let r=0,b=a.length;r<b;++r)a[r].pick=!1}for(let c=0,p=l.length;c<p;++c){const a=l[c];for(let r=0,b=a.length;r<b;++r){let d=!1;for(let k=0,C=u.length;k<C;++k){const T=u[k];for(let h=0,R=T.length;h<R;++h)a[r].pick&&T[h].pick||a[r].id!==T[h].id&&s(a[r],T[h],o)&&(n||(f=!0,a[r].pick=!0,T[h].pick=!0),d=!0)}!d&&n&&(f=!0,a[r].pick=!0)}}for(let c=0,p=l.length;c<p;++c){let a=l[c],r=0;for(let b=0,d=a.length;b<d;++b){let k=a[b];a[b].pick&&(a[r]=k,r++)}a.length=r}if(!n)for(let c=0,p=u.length;c<p;++c){let a=u[c],r=0;for(let b=0,d=a.length;b<d;++b){let k=a[b];a[b].pick&&(a[r]=k,r++)}a.length=r}return f},g.pickObjectsIf=function(s,t,e,n){let o=!1;const f=i.staticArray(i.evtTools.object.pickObjectsIf);t.values(f);for(let l=0,u=f.length;l<u;++l){const c=f[l];for(let p=0,a=c.length;p<a;++p){const r=c[p];e^s(r,n)?(o=!0,r.pick=!0):r.pick=!1}}for(let l=0,u=f.length;l<u;++l)i.evtTools.object.filterPickedObjectsList(f[l]);return o},g.filterPickedObjectsList=function(s){let t=0;for(let e=0,n=s.length;e<n;++e){const o=s[e];o.pick&&(s[t]=o,t++)}s.length=t},g.hitBoxesCollisionTest=function(s,t,e,n,o){return i.evtTools.object.twoListsTest(i.RuntimeObject.collisionTest,s,t,e,o)},g._distanceBetweenObjects=function(s,t,e){return s.getSqDistanceToObject(t)<=e},g.distanceTest=function(s,t,e,n){return i.evtTools.object.twoListsTest(i.evtTools.object._distanceBetweenObjects,s,t,n,e*e)},g._movesToward=function(s,t,e){if(s.hasNoForces())return!1;let n=Math.atan2(t.getDrawableY()+t.getCenterY()-(s.getDrawableY()+s.getCenterY()),t.getDrawableX()+t.getCenterX()-(s.getDrawableX()+s.getCenterX()));return n*=180/3.14159,Math.abs(i.evtTools.common.angleDifference(s.getAverageForce().getAngle(),n))<=e/2},g.movesTowardTest=function(s,t,e,n){return i.evtTools.object.twoListsTest(i.evtTools.object._movesToward,s,t,n,e)},g._turnedToward=function(s,t,e){let n=Math.atan2(t.getDrawableY()+t.getCenterY()-(s.getDrawableY()+s.getCenterY()),t.getDrawableX()+t.getCenterX()-(s.getDrawableX()+s.getCenterX()));return n*=180/3.14159,Math.abs(i.evtTools.common.angleDifference(s.getAngle(),n))<=e/2},g.turnedTowardTest=function(s,t,e,n){return i.evtTools.object.twoListsTest(i.evtTools.object._turnedToward,s,t,n,e)},g.pickAllObjects=function(s,t){for(const e in t.items)if(t.items.hasOwnProperty(e)){const n=s.getObjects(e),o=t.items[e];o.length=0,o.push.apply(o,n)}return!0},g.pickRandomObject=function(s,t){let e=0;for(let l in t.items)t.items.hasOwnProperty(l)&&(e+=t.items[l].length);if(e===0)return!1;let n=Math.floor(Math.random()*e);n>=e&&(n=e-1);let o=0,f=null;for(let l in t.items)if(t.items.hasOwnProperty(l)){let u=t.items[l];if(n-o<u.length){f=u[n-o];break}o+=u.length}return i.evtTools.object.pickOnly(t,f),!0},g.pickNearestObject=function(s,t,e,n){let o=null,f=0,l=!0;const u=i.staticArray(i.evtTools.object.pickNearestObject);s.values(u);for(let c=0,p=u.length;c<p;++c){const a=u[c];for(let r=0;r<a.length;++r){const b=a[r],d=b.getSqDistanceToPosition(t,e);(l||d<f^n)&&(f=d,o=b),l=!1}}return o?(i.evtTools.object.pickOnly(s,o),!0):!1},g.raycastObject=function(s,t,e,n,o,f,l,u){return i.evtTools.object.raycastObjectToPosition(s,t,e,t+o*Math.cos(n*Math.PI/180),e+o*Math.sin(n*Math.PI/180),f,l,u)},g.raycastObjectToPosition=function(s,t,e,n,o,f,l,u){let c=null,p=u?0:(n-t)*(n-t)+(o-e)*(o-e),a=0,r=0;const b=i.staticArray(i.evtTools.object.raycastObjectToPosition);s.values(b);for(let d=0;d<b.length;d++){const k=b[d];for(let C=0;C<k.length;C++){const T=k[C],h=T.raycastTest(t,e,n,o,!u);h.collision&&(!u&&h.closeSqDist<=p?(p=h.closeSqDist,c=T,a=h.closeX,r=h.closeY):u&&h.farSqDist>=p&&(p=h.farSqDist,c=T,a=h.farX,r=h.farY))}}return c?(i.evtTools.object.pickOnly(s,c),f.setNumber(a),l.setNumber(r),!0):!1},g.doCreateObjectOnScene=function(s,t,e,n,o,f){const l=s.createObject(t),u=s.getLayer(f);return l!==null&&(l.setPosition(n,o),l.setLayer(f),l.setZOrder(u.getDefaultZOrder()),e.containsKey(t)&&e.get(t).push(l)),l},g.createObjectOnScene=function(s,t,e,n,o){return i.evtTools.object.doCreateObjectOnScene(s,t.firstKey(),t,e,n,o)},g.createObjectFromGroupOnScene=function(s,t,e,n,o,f){i.evtTools.object.doCreateObjectOnScene(s,e,t,n,o,f)},g.getPickedInstancesCount=s=>{let t=0;const e=i.staticArray(i.evtTools.object.getPickedInstancesCount);s.values(e);for(let n=0,o=e.length;n<o;++n)t+=e[n].length;return t},g.getSceneInstancesCount=(s,t)=>{let e=0;const n=i.staticArray(i.evtTools.object.getSceneInstancesCount);t.keys(n);const o=new Set(n);for(const f of o)e+=s.getInstancesCountOnScene(f);return e},g.pickedObjectsCount=g.getPickedInstancesCount})(w=O.object||(O.object={}))})(y=i.evtTools||(i.evtTools={}));class L{constructor(){this.objectsLists=new Map;this.localVariablesContainers=[];this.callbacks=new Map;this.parent=null}static from(O){const j=new L;return j.parent=O,j}getOrCreateList(O){return this.objectsLists.has(O)||this.objectsLists.set(O,[]),this.objectsLists.get(O)}getObjects(O){return!this.objectsLists.has(O)&&this.parent?this.parent.getObjects(O):this.objectsLists.get(O)||[]}addObject(O,j){const v=this.getOrCreateList(O);if(v.includes(j))return;v.push(j);const m=()=>this.removeObject(O,j);this.callbacks.set(j,m),j.registerDestroyCallback(m)}removeObject(O,j){const v=this.getOrCreateList(O),m=v.indexOf(j);m!==-1&&(v.splice(m,1),j.unregisterDestroyCallback(this.callbacks.get(j)),this.callbacks.delete(j))}restoreLocalVariablesContainers(O){i.copyArray(this.localVariablesContainers,O)}backupLocalVariablesContainers(O){i.copyArray(O,this.localVariablesContainers)}}i.LongLivedObjectsList=L})(gdjs||(gdjs={}));
//# sourceMappingURL=objecttools.js.map
